---
title: "Mini Proyecto Tratamiento de Datos"
author: "Grupo I"
output: html_document
date: "2025-04-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(pdftools)

# Listar todos los PDFs con "Mercadona" en el nombre dentro de la carpeta 'data', así mismo, devuelve un vector con las rutas completas de archivos que cumplen las condiciones de filtrado.
ficheros <- list.files(path = "data", pattern = "Mercadona", full.names = TRUE)

# Definimos una funcion
leer_ticket <- function(x) {
  data <- pdf_text(x) # Leemos todo el texto de los pdfs filtrados
  lineas <- strsplit(data, "\n")[[1]] # Strsplit para separar el texto en lineas
  lineas <- lineas[nchar(trimws(lineas)) > 0]  # Usamos este comando para hacer que las lineas que no contengan caracteres se eliminen. Trimws quita los espacios en blanco al inicio y final de cada linea, posteriormente hacemos la comprobacion de caracteres restantes con nchar, si el valor es > 0, se seleccionan, si no tienen al menos un caracter; se omiten.
  
    df <- data.frame(
    fichero = basename(x),
    linea = seq_along(lineas),
    contenido = lineas,
    stringsAsFactors = FALSE
  )
    # Creamos un df, la primera columna siendo los nombres de los pdfs, la segunda siendo el numero de linea (seq_along) y la tercera siendo el contenido de cada una de las lineas leidas.
  
  return(df)
}

df_tickets <- do.call(rbind, lapply(ficheros, leer_ticket))

#lapply para aplicarle la funcion x al vector de ficheros
#do.call(rbind) hacemos un append de los ficheros para tenerlos todos en un mismo df

View(df_tickets)


```

Hemos leído los tickets de supermercado usando `pdf_text()` y transformado su contenido en un `data.frame`.

La siguiente tabla muestra un ejemplo del contenido:

```{r}
head(df_tickets, 10)
```
Tabla 1. Primeras líneas extraídas de los tickets de Mercadona.
Como se muestra en la Tabla 1, los tickets contienen información línea por línea, que luego se puede procesar para extraer los productos, precios o fechas.


Tras realizar la importación de los datos y observar la información que nos 
aportan los tickets, nos planteamos una serie de preguntas:


- ¿Cuántos productos suele incluir un ticket promedio? ¿Y el importe promedio por ticket?

- ¿Las tiendas en ciudades grandes (como Valencia) tienen tickets con importes más altos que las de pueblos pequeños?

- ¿Cuál es el producto más caro vendido por unidades? ¿Y el más barato?

- ¿A qué horas del día se realizan más compras?


También trataremos de responder a las preguntas que nos plantean en el proyecto, 
que son las siguientes:


- ¿Cuáles son los 5 productos, de los vendidos por unidades, con más ventas ? 
¿Cuántas unidades de cada uno se han vendido ?

- Si consideramos la categoría de FRUTAS Y VERDURAS. 
Cuáles son los 5 productos más vendidos ? ¿Cuántos kilos se han vendido de cada uno de estos productos ?

- Si consideramos la categoría de PESCADO. 
Cuáles son los 5 productos más vendidos ? ¿Cuántos kilos se han vendido de cada uno de estos productos ?

- Muestra mediante un gráfico de líneas como ha variado el precio por kilo de 
las bananas y los plátanos en los tickets disponibles, a lo largo del tiempo.

- ¿Cuál es la procedencia de los tickets ?¿ Qué ciudad/ pueblo tiene un mayor número de tickets ?2

- Muestra mediante un diagrama el número de tickets recogidos cada día de las semana. 
¿Si tuvieses que cerrar un día entre semana qué día lo harías ?

